---
title: "PLSsem_model_forNCKH"
author: "Lộc"
date: "2023-03-09"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Call packages:

```{r}
library(seminr)
```

## Transform dataset NC_dat1 to NC_dat3 to easy to implement PLS sem:

```{r}
NC_dat1<-NC_dat1 %>% 
  select(-QoF3) %>% 
  rename(QoF3 = QoF4,
         QoF4 = QoT1,
         QoF5 = QoT2,
         QoF6 = QoT3,
         QoF7 = QoT4)
```

## Define measurement model:

```{r}
PLSsem_mm <- constructs(
  composite("DVPT", multi_items("QoF", 1:7)),
                                
  composite("TLHK", multi_items("QoCU", c(1:4,6))),
  
  composite("KNND", multi_items("QoIN", 2:3)),
  
  composite("TMDT", multi_items("QoIN",4:5)),
                                  
  composite("CPDT", multi_items("QoCO",1:4))
)
```

## Define structure model:

```{r}
PLSsem_sm <- relationships(
  paths(from =c("KNND","TMDT","CPDT","DVPT"),to =c("TLHK")),
  paths(from =c("CPDT"),to =c("TMDT","DVPT")),
  paths(from =c("DVPT"),to =c("TMDT"))
)
```

## Define PLS sem model:

```{r}
PLSsem_model <- estimate_pls(
  data = NC_dat1,
  measurement_model = PLSsem_mm,
  structural_model  = PLSsem_sm,
  inner_weights = path_weighting,
  missing = mean_replacement,
  missing_value = "-99")
```

## Summary the result:

```{r}
#Export the path coeffiecients and eliability metrics:
summary(PLSsem_model)
```

### Evaluate the indicator reliability

```{r}
model_summary<-summary(PLSsem_model)

#Extract the loadings
model_summary$loadings
```

--\>Tất cả các indicator loadings đều trên 0.7 nên được acceptable

### Evaluate the internal consistency reliability

```{r}
#Extracting and lotting the indicator reliability
model_summary$reliability

plot(m$reliability)
```

### Evaluate the discriminant validty:

```{r}
#Extract the HTMT (the mean value of the indicator correlations across constructs)
model_summary$validity$htmt
```

```{r}
#Boopstrapping to estimate standard errors and compute confidence intervals:
boot_PLSsem_model <- bootstrap_model(seminr_model = PLSsem_model,
  nboot = 500,
  cores = NULL,
  seed = 123)

```

```{r}
#Extract the result of bootstrapping:
boot_model_summmary<-summary(boot_PLSsem_model)
```

## Evaluation of the structural model:

### Evaluate the Collinearity issues: (Đa cộng tuyến)

```{r}
model_summary$vif_antecedents
```

Gía trị VIF \> 5 có khả năng bị đa cộng tuyến.

### Evaluate the significance and relevance of the structural model relationships:

```{r}
boot_model_summmary$bootstrapped_paths
```

### Evaluate the explanatory power:

```{r}
#Extract the R^2 and Standard R^2:
model_summary$paths
```

```{r}
#Extract the f^2:
model_summary$fSquare
```

### Predictive power:

```{r}
predict_model <- predict_pls(
  model = PLSsem_model,
  technique = predict_DA,
  noFolds = 10,
  reps = 10)
summary_predict_model<-summary(predict_model)
```

```{r}
#Plotting the prediction error of indicators:
par(mfrow=c(1,3))
plot(summary_predict_model,
  indicator = "QoF1")
plot(summary_predict_model,
  indicator = "QoF2")
plot(summary_predict_model,
  indicator = "QoF3")
par(mfrow=c(1,1))

#Extract the index RMSE(MAE) to compare to LM:
summary_predict_model
```

-High predictive power: All indicators in the PLS-SEM analysis have lower RMSE (or MAE) values compared to the LM. -Medium predictive power: The majority (or the same number) of the indicators in the PLS-SEM analysis have lower RMSE (or MAE) values compared to the LM. -Low predictive power: The minority of the of the indicators in the PLS-SEM analysis have lower RMSE (or MAE) values compared to the LM. -Lack of predictive power: None of the of the indicators in the PLS-SEM analysis have lower RMSE (or MAE) values compared to the LM.
